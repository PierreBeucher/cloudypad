# Deploy Sunshine in container
# Use with -e sunshine_nvidia_enable=true for Nvidia GPU
---
- name: "Wait for machine to be reachable (timeout: 5min)"
  hosts: all
  gather_facts: false
  tasks:
    - wait_for_connection:
        timeout: 300
        sleep: 5

- name: Sunshine container
  hosts: all
  roles:
    - role: geerlingguy.docker
      tags: [ docker ]
      become: true
      docker_users:
      - "{{ ansible_user_id }}"
    - role: roles/nvidia-driver
      tags: [ nvidia ]
      become: true
      when: sunshine_nvidia_enable
      vars:
        nvidia_driver_module_params: |
          # nvidia-drm module is required by Wolf
          options nvidia-drm modeset=1
    - role: roles/sunshine
      tags: [ sunshine ]