---
- name: "Wait for machine to be reachable (timeout: 5min)"
  hosts: all
  gather_facts: false
  tasks:
    - wait_for_connection:
        timeout: 300
        sleep: 5

- name: Sunshine Ubuntu 24.04
  hosts: all
  roles:
    - role: roles/x11-gdm
      tags: [ x11, gdm ]
      become: true
    - role: roles/nvidia-driver
      tags: [ nvidia ]
      become: true
      vars:
        nvidia_driver_module_params: |
          # nvidia-drm module is required by Wolf
          options nvidia-drm modeset=1
    - role: roles/x11-virtual-screen
      tags: [ x11, gdm ]
      become: true
    - role: roles/sunshine-install
      tags: [ sunshine ]
      become: true

# Install sunshine service for sunshine user so that it can be started on startup with auto-login
- name: Sunshine Ubuntu 24.04
  hosts: all
  vars:
    ansible_user: sunshine
  roles:  
    - role: roles/sunshine-user-service
      tags: [ sunshine-user ]
